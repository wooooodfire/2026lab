<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 lab遊 - 宜蘭</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #f8fafc; overflow: hidden; }
        
        /* 電腦版分隔線 */
        #resizer {
            width: 8px;
            cursor: col-resize;
            background: #e2e8f0;
            transition: background 0.2s;
            z-index: 40;
        }
        #resizer:hover { background: #0d9488; }

        /* 圖片輪播 */
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            gap: 12px;
        }
        .carousel-container::-webkit-scrollbar { display: none; }
        .carousel-item {
            flex: 0 0 85%;
            scroll-snap-align: center;
            aspect-ratio: 16/9;
            background: #cbd5e1;
            border-radius: 12px;
            object-fit: cover;
        }

        /* 行程卡片優化 */
        .timeline-item.active-card {
            border-left: 4px solid #0d9488;
            background-color: #f0fdfa;
            transform: translateX(4px);
        }

        @media (max-width: 768px) {
            .mobile-panel {
                position: absolute;
                bottom: 0;
                height: 50vh;
                z-index: 50;
                transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .mobile-panel.expanded { height: 85vh; }
            #resizer { display: none; }
            #map { height: 60vh !important; }
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <nav class="bg-teal-700 text-white p-4 shadow-md z-50 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold italic tracking-tight">YILAN 2026 LAB</h1>
            <p class="text-xs opacity-75">1/27 - 1/29 · 宜蘭考察</p>
        </div>
        <div class="text-right">
            <span class="text-sm font-semibold bg-teal-800 px-3 py-1 rounded-full" id="total-cost-nav"></span>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden relative">
        <div id="left-panel" class="mobile-panel w-full md:w-[35%] bg-white flex flex-col shadow-2xl z-40">
            <div class="md:hidden flex justify-center py-2 cursor-pointer" onclick="toggleMobilePanel()">
                <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
            </div>

            <div class="flex border-b overflow-x-auto bg-gray-50 shrink-0" id="day-tabs"></div>

            <div id="itinerary-list" class="flex-1 overflow-y-auto p-4 space-y-2">
                </div>
        </div>

        <div id="resizer"></div>

        <div id="right-panel" class="flex-1 flex flex-col relative bg-gray-100">
            <div id="map" class="flex-1 z-10"></div>
            
            <div id="details-overlay" class="hidden absolute right-4 top-4 bottom-4 w-80 bg-white/95 backdrop-blur shadow-2xl z-20 rounded-2xl border border-gray-100 p-5 overflow-y-auto transition-all">
                <button onclick="closeDetails()" class="float-right text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
                
                <div id="detail-header" class="mb-4">
                    <span id="detail-tag" class="text-[10px] font-bold uppercase tracking-widest text-teal-600">景點</span>
                    <h2 id="detail-title" class="text-2xl font-black text-gray-800 mt-1"></h2>
                </div>

                <div class="carousel-container mb-4" id="detail-images">
                    <div class="carousel-item flex items-center justify-center text-gray-400">圖片 1 (預留)</div>
                    <div class="carousel-item flex items-center justify-center text-gray-400">圖片 2 (預留)</div>
                    <div class="carousel-item flex items-center justify-center text-gray-400">圖片 3 (預留)</div>
                </div>

                <div class="space-y-4">
                    <div>
                        <h4 class="text-xs font-bold text-gray-400 mb-1">關於這裡</h4>
                        <p id="detail-desc" class="text-sm text-gray-600 leading-relaxed"></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <div class="bg-gray-50 p-3 rounded-xl">
                            <span class="block text-[10px] text-gray-400">預計費用</span>
                            <span id="detail-cost" class="font-bold text-orange-600"></span>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-xl">
                            <span class="block text-[10px] text-gray-400">抵達時間</span>
                            <span id="detail-time" class="font-bold text-gray-700"></span>
                        </div>
                    </div>

                    <div id="extra-info" class="text-xs bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-yellow-800">
                        <i class="fa-solid fa-circle-info mr-1"></i> <span id="detail-notes">這裡可以塞更多備註文字...</span>
                    </div>

                    <a id="btn-nav" href="#" target="_blank" class="block w-full bg-teal-600 text-white text-center py-3 rounded-xl font-bold shadow-lg shadow-teal-100 hover:bg-teal-700 transition">
                        <i class="fa-solid fa-map-pin mr-2"></i>開始導航
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 資料結構保持不變，可由你原本的資料帶入
        const itineraryData = {
            meta: {
                groupSize: "11人以上團體",
                accommodation: "宜蘭縣三星鄉三星路二段601巷15弄100號",
                accommodationCoord: [24.666707221704357, 121.69852736270126]
            },
            days: [
                {
                    id: "day1",
                    date: "1/27 (二)",
                    title: "出發與礁溪溫泉",
                    stops: [
                        { time: "09:00-11:00", name: "高雄 → 台北車站(高鐵)", type: "transport", cost: "NT$1,115", desc: "全員集合出發，搭乘高鐵前往台北。", lat: null, lng: null, items: ["高鐵"], web: "", mapUrl: "", addr: "" },
                        { time: "11:00-11:10", name: "台北車站集合", type: "gather", cost: "", desc: "確認人數與行李。", lat: 25.0478, lng: 121.5170, items: [], web: "", mapUrl: "https://goo.gl/maps/TaipeiMain", addr: "台北市中正區" },
                        { time: "11:10-12:10", name: "台北 → 福哥石窯雞 (包車)", type: "transport", cost: "NT$1,500 (車資分攤)", desc: "搭乘包車前往宜蘭礁溪。", lat: null, lng: null, items: [], web: "", mapUrl: "", addr: "" },
                        { time: "12:10-13:30", name: "午餐: 福哥石窯雞-礁溪總店", type: "food", cost: "NT$500", desc: "享用宜蘭特色石窯雞料理。", lat: 24.836912655727083, lng: 121.78568772830744, items: ["福哥石窯雞-礁溪總店"], web: "", mapUrl: "https://maps.app.goo.gl/uTAvAcapRL62Q53A9", addr: "宜蘭縣礁溪鄉" },
                        { time: "13:30-16:00", name: "蘭陽博物館", type: "sight", cost: "NT$110", desc: "參觀獨特單面山建築造型博物館，了解宜蘭地理人文。", lat: 24.8687667354629, lng: 121.83277354363076, items: ["蘭陽博物館"], web: "", mapUrl: "https://maps.app.goo.gl/Ph6DKoN9odgNYPaH9", addr: "宜蘭縣頭城鎮" },
                        { time: "16:00-18:00", name: "星河傳說溫泉水世界", type: "activity", cost: "NT$250", desc: "全宜蘭最大溫泉樂園，享受放鬆時光。", lat: 24.827735538626257, lng: 121.77324533386637, items: ["中冠礁溪大飯店"], web: "https://www.art-spa-hotel.com.tw/", mapUrl: "https://maps.app.goo.gl/NsnVwrLLwbMfN8Rk6", addr: "宜蘭縣礁溪鄉" },
                        { time: "18:00-19:30", name: "晚餐: 礁溪庄櫻桃谷", type: "food", cost: "NT$800", desc: "品嚐知名的櫻桃鴨料理。", lat: 24.836503935551125, lng: 121.78593645396221, items: [], web: "", mapUrl: "https://maps.app.goo.gl/gknPAXUWuvHDQcPY7", addr: "宜蘭縣礁溪鄉" },
                        { time: "19:30~", name: "回民宿 (三星鄉)", type: "rest", cost: "NT$1,000", desc: "入住 Taco House 民宿。整理行李與休息。", lat: 24.666707221704357, lng: 121.69852736270126, items: [], web: "https://twstay.com/RWD2/index.aspx?BNB=tacoesubooking", mapUrl: "https://maps.app.goo.gl/PfXS2nfVGE8oabwv6", addr: "宜蘭縣三星鄉三星路二段601巷15弄100號" }
                    ]
                },
                {
                    id: "day2",
                    date: "1/28 (三)",
                    title: "太平山森林浴",
                    stops: [
                        { time: "09:30-10:00", name: "民宿集合", type: "gather", cost: "", desc: "早晨集合，準備出發。", lat: 24.666707221704357, lng: 121.69852736270126, items: [], web: "", mapUrl: "", addr: "民宿" },
                        { time: "10:00-11:30", name: "民宿 → 太平山莊餐廳", type: "transport", cost: "", desc: "車程約 1.5 小時，前往太平山。", lat: null, lng: null, items: [], web: "", mapUrl: "", addr: "" },
                        { time: "11:30-13:00", name: "午餐: 太平山莊餐廳", type: "food", cost: "NT$400", desc: "在山林間享用午餐。", lat: 24.49332839003274, lng: 121.53625473512425, items: ["太平山國家森林遊樂區入口網-餐飲服務"], web: "", mapUrl: "https://maps.app.goo.gl/YvzhQX5PnEtdVKu37", addr: "太平山" },
                        { time: "13:00-16:00", name: "太平山國家森林公園", type: "sight", cost: "NT$150", desc: "漫步森林步道，可搭乘蹦蹦車（需現場購票）。", lat: 24.49800149525048, lng: 121.5349489551065, items: ["太平山森林遊樂區", "蹦蹦車"], web: "https://tps.forest.gov.tw/", mapUrl: "https://maps.app.goo.gl/JQU731VF8aNr8wLU9", addr: "太平山" },
                        { time: "16:00-17:30", name: "下山前往羅東", type: "transport", cost: "", desc: "車程約 1.5 小時。", lat: null, lng: null, items: [], web: "", mapUrl: "", addr: "" },
                        { time: "17:30-20:00", name: "羅東夜市", type: "food", cost: "個人消費", desc: "宜蘭最知名的夜市，自行覓食。", lat: 24.677519480047078, lng: 121.76822012526692, items: [], web: "", mapUrl: "https://maps.app.goo.gl/5SfN2atmmniiczU3A", addr: "宜蘭縣羅東鎮" },
                        { time: "20:00~", name: "回民宿", type: "rest", cost: "NT$1,000", desc: "返回三星鄉民宿。", lat: 24.666707221704357, lng: 121.69852736270126, items: [], web: "", mapUrl: "", addr: "民宿" }
                    ]
                },
                {
                    id: "day2_rain",
                    date: "1/28 (三) 雨備",
                    title: "室內文化與動感",
                    isRain: true,
                    stops: [
                        { time: "09:30-10:00", name: "民宿集合", type: "gather", cost: "", desc: "早晨集合。", lat: 24.666707221704357, lng: 121.69852736270126, items: [], web: "", mapUrl: "", addr: "民宿" },
                        { time: "10:30-12:30", name: "宜蘭傳藝園區", type: "sight", cost: "NT$120", desc: "雨天首選，體驗傳統工藝與表演。", lat: 24.686378995704747, lng: 121.82395619640673, items: ["宜蘭傳藝園區"], web: "https://www.px-sunmake.org.tw/", mapUrl: "https://maps.app.goo.gl/4RS2YbMGtwjVPQv39", addr: "宜蘭縣五結鄉" },
                        { time: "12:30-14:00", name: "中餐 (待定)", type: "food", cost: "", desc: "於傳藝園區內或周邊用餐。", lat: null, lng: null, items: [], web: "", mapUrl: "", addr: "" },
                        { time: "14:00-17:00", name: "空氣島彈跳工廠", type: "activity", cost: "NT$500", desc: "室內極限運動，適合團體放電。", lat: 24.59602981881871, lng: 121.85672281349535, items: ["空氣島彈跳工廠"], web: "", mapUrl: "https://maps.app.goo.gl/Yb9LCHNPEaxqmKxw8", addr: "宜蘭縣蘇澳鎮" },
                        { time: "17:30-20:00", name: "羅東夜市", type: "food", cost: "個人消費", desc: "雨天逛街請攜帶雨具。", lat: 24.677519480047078, lng: 121.76822012526692, items: [], web: "", mapUrl: "https://maps.app.goo.gl/5SfN2atmmniiczU3A", addr: "羅東鎮" },
                        { time: "20:00~", name: "回民宿", type: "rest", cost: "", desc: "返回休息。", lat: 24.666707221704357, lng: 121.69852736270126, items: [], web: "", mapUrl: "", addr: "民宿" }
                    ]
                },
                {
                    id: "day3",
                    date: "1/29 (四)",
                    title: "萌寵與手作",
                    stops: [
                        { time: "10:00-12:00", name: "張美阿嬤農場", type: "activity", cost: "NT$200", desc: "熱門景點，餵食水豚與梅花鹿體驗。", lat: 24.675008463330684, lng: 121.67556508466048, items: ["張美阿嬤農場"], web: "", mapUrl: "https://maps.app.goo.gl/gDLFhRnSbRUuufaw9", addr: "宜蘭縣三星鄉" },
                        { time: "12:00-13:00", name: "午餐: 樹懶餐廳", type: "food", cost: "NT$500", desc: "農場周邊特色餐廳。", lat: 24.681128507670874, lng: 121.67592878650466, items: [], web: "", mapUrl: "https://maps.app.goo.gl/BohoRJ2xzjwxmWc99", addr: "宜蘭縣三星鄉" },
                        { time: "13:00-15:30", name: "三星四季青花瓷", type: "activity", cost: "NT$600", desc: "器皿體驗｜青花瓷拓繪 DIY。", lat: 24.671655013390385, lng: 121.67625953067905, items: ["三星四季青花瓷"], web: "https://3s4s.weebly.com/39636395112796321205.html", mapUrl: "https://maps.app.goo.gl/XZuLYknkVNtKPRix7", addr: "宜蘭縣三星鄉" },
                        { time: "15:30-17:00", name: "宜蘭 → 台北車站", type: "transport", cost: "", desc: "搭車返回台北，結束旅程。", lat: 25.0478, lng: 121.5170, items: [], web: "", mapUrl: "", addr: "台北車站" }
                    ]
                }
            ]
        };

        let map, activeDayId = "day1";

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            initResizer();
            renderTabs();
            renderTimeline(activeDayId);
            document.getElementById('total-cost-nav').innerText = "預算約 $8,125";
        });

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([24.75, 121.75], 11);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
            L.control.zoom({ position: 'bottomright' }).addTo(map);
        }

        // 電腦版分隔線拉動邏輯
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const leftPanel = document.getElementById('left-panel');
            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                let offsetLeft = e.clientX;
                let minWidth = 300;
                let maxWidth = window.innerWidth * 0.6;
                if (offsetLeft > minWidth && offsetLeft < maxWidth) {
                    leftPanel.style.width = `${offsetLeft}px`;
                    map.invalidateSize();
                }
            });

            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = 'default';
            });
        }

        function toggleMobilePanel() {
            document.getElementById('left-panel').classList.toggle('expanded');
        }

        function renderTabs() {
            const container = document.getElementById('day-tabs');
            itineraryData.days.forEach(day => {
                const active = activeDayId === day.id ? 'text-teal-600 border-b-2 border-teal-600 font-bold' : 'text-gray-400';
                container.innerHTML += `<button onclick="switchDay('${day.id}')" class="px-6 py-4 text-sm whitespace-nowrap ${active}">${day.date}</button>`;
            });
        }

        function switchDay(id) {
            activeDayId = id;
            document.getElementById('day-tabs').innerHTML = '';
            renderTabs();
            renderTimeline(id);
        }

        function renderTimeline(dayId) {
            const container = document.getElementById('itinerary-list');
            container.innerHTML = '';
            const day = itineraryData.days.find(d => d.id === dayId);
            
            day.stops.forEach((stop, i) => {
                const card = document.createElement('div');
                card.className = "timeline-item flex gap-4 p-4 rounded-xl cursor-pointer transition duration-200 border border-transparent hover:border-teal-100";
                card.onclick = () => showDetails(stop, card);
                
                card.innerHTML = `
                    <div class="text-xs font-mono font-bold text-gray-400 pt-1">${stop.time}</div>
                    <div>
                        <h3 class="font-bold text-gray-800">${stop.name}</h3>
                        <p class="text-xs text-gray-500 line-clamp-1">${stop.desc}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function showDetails(stop, element) {
            // UI 反饋
            document.querySelectorAll('.timeline-item').forEach(el => el.classList.remove('active-card'));
            element.classList.add('active-card');

            // 填入資料
            document.getElementById('detail-title').innerText = stop.name;
            document.getElementById('detail-desc').innerText = stop.desc;
            document.getElementById('detail-time').innerText = stop.time;
            document.getElementById('detail-cost').innerText = stop.cost;
            document.getElementById('btn-nav').href = `https://www.google.com/maps/dir/?api=1&destination=${stop.lat},${stop.lng}`;
            
            // 顯示面板
            const overlay = document.getElementById('details-overlay');
            overlay.classList.remove('hidden');

            // 地圖移動
            map.flyTo([stop.lat, stop.lng], 15);
        }

        function closeDetails() {
            document.getElementById('details-overlay').classList.add('hidden');
            document.querySelectorAll('.timeline-item').forEach(el => el.classList.remove('active-card'));
        }
    </script>
</body>
</html>
